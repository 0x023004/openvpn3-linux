<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <policy context="default">
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="Import"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="FetchAvailableConfigs"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="Fetch"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="FetchJSON"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="SetOption"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="SetOverride"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="UnsetOverride"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="AccessGrant"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="AccessRevoke"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="Seal"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="Remove"/>

    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Get"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="GetAll"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Set"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Introspectable"
           send_type="method_call"
           send_member="Introspect"/>

    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="NewTunnel"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="FetchAvailableSessions"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Connect"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Pause"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Resume"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Restart"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Disconnect"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="Ready"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="UserInputQueueGetTypeGroup"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="UserInputQueueFetch"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="UserInputQueueCheck"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="UserInputProvide"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="AccessGrant"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="AccessRevoke"/>

    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Get"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="GetAll"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Set"/>
    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Introspectable"
           send_type="method_call"
           send_member="Introspect"/>

    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <!--
         Only the "@OPENVPN_USERNAME@" user is allowed to
         receive backend signals
    -->
    <deny receive_interface="net.openvpn.v3.backends"
          receive_type="signal"/>
  </policy>

  <policy user="@OPENVPN_USERNAME@">
    <allow own="net.openvpn.v3.log"/>

    <allow own="net.openvpn.v3.configuration"/>

    <allow own="net.openvpn.v3.sessions"/>

    <allow own="net.openvpn.v3.netcfg"/>

    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Attach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Detach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="GetAll"/>

    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="StartClient"/>

    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="RegistrationConfirmation"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Ping"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Connect"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Pause"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Resume"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Restart"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Disconnect"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="ForceShutdown"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="Ready"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="UserInputQueueGetTypeGroup"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="UserInputQueueFetch"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="UserInputQueueCheck"/>
    <allow send_interface="net.openvpn.v3.backends"
           send_type="method_call"
           send_member="UserInputProvide"/>

    <!--
         Signals sent by backends are allowed for
         the "@OPENVPN_USERNAME@" user.  This is needed
         to be able to manage and react to VPN client backend
         events.  The session manager (running as "@OPENVPN_USERNAME@")
         will proxy these signals to the proper receiver(s).
     -->
    <allow receive_interface="net.openvpn.v3.backends"
           receive_type="signal"
           receive_member="AttentionRequired"/>
    <allow receive_interface="net.openvpn.v3.backends"
           receive_type="signal"
           receive_member="Log"/>
    <allow receive_interface="net.openvpn.v3.backends"
           receive_type="signal"
           receive_member="RegistrationRequest"/>
    <allow receive_interface="net.openvpn.v3.backends"
           receive_type="signal"
           receive_member="StatusChange"/>

    <!--
         The "@OPENVPN_USERNAME@" needs these privileges to get/set properties
         in the backend VPN client objects.  Only this user needs these
         privileges
    -->
    <allow send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Get"/>
    <allow send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Set"/>

    <allow send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="GetAll"/>

    <allow send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

  </policy>

  <policy user="root">
    <allow send_destination="net.openvpn.v3.configuration"
	send_interface="net.openvpn.v3.configuration"
	send_type="method_call"
	send_member="Fetch"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="net.openvpn.v3.configuration"
           send_type="method_call"
           send_member="TransferOwnership"/>
    <allow send_destination="net.openvpn.v3.configuration"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="net.openvpn.v3.sessions"
           send_type="method_call"
           send_member="TransferOwnership"/>

    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Attach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Detach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <allow send_destination="net.openvpn.v3.backends"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <allow send_destination="net.openvpn.v3.sessions"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>

    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Attach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="net.openvpn.v3.log"
           send_type="method_call"
           send_member="Detach"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Peer"
           send_type="method_call"
           send_member="Ping"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Get"
           send_path="/net/openvpn/v3/log"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="GetAll"
           send_path="/net/openvpn/v3/log"/>
    <allow send_destination="net.openvpn.v3.log"
           send_interface="org.freedesktop.DBus.Properties"
           send_type="method_call"
           send_member="Set"
           send_path="/net/openvpn/v3/log"/>

    <allow own_prefix="net.openvpn.v3.backends"/>
  </policy>

</busconfig>
